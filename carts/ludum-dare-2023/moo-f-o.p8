pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- moo f.o.
-- by david couzelis

-- player info
plx=0
ply=0
ploffx=6
ploffy=6
plwidth=4
plheight=3
plfrm=1

win=false
dead=false

-- map info
mp=0

cows={}
birds={}

function _init()
 -- set pink to transparent
 palt(0,false)
 palt(14,true)

 init_stage()
end

cowficulty=19

function init_stage()
 plx=(128/2)-(8)
 ply=(128/2)-(8)
 win=false
 dead=false
 explode_cnt=0
 
 local row=0
 local col=0
 local cownter=cowficulty
 for row=0,15 do
  for col=0,15 do
   if not fget(mget(col,row),1) then
    cownter-=1
    if cownter==0 then
     local cow={
      x=col*8,
      y=row*8
     }
     add(cows,cow)
     cownter=cowficulty
    end
   end
  end
 end
end

function pl_l()
 return plx+ploffx
end

function pl_r()
 return plx+ploffx+plwidth
end

function pl_u()
 return ply+ploffy
end

function pl_d()
 return ply+ploffy+plheight
end

function mp_hit(x,y)
 return fget(mget(x,y),1)
end

function explode()
 if explode_cnt<3 then
  plfrm=33
 elseif explode_cnt<6 then
  plfrm=35
 elseif explode_cnt<9 then
  plfrm=37
 else
  plfrm=39
 end
 explode_cnt+=1
end

function collect_cow(cow)
 local cx=flr(cow.x/8)
 local cy=flr(cow.y/8)
 local px=flr((plx+4)/8)
 local py=flr((ply+4)/8)
 if (px==cx and py==cy) or
    (px+1==cx and py==cy) or
    (px==cx and py+1==cy) or
    (px+1==cx and py+1==cy) then
  del(cows,cow)
 end   
end

function _update()

 -- win?
 if win then
--  if btnp(0) or btnp(1) or btnp(2) or
--     btnp(4) or btnp(5) then
--   init_stage()
--  end
  return
 end

 -- dead?
 if dead then
  explode()
  if explode_cnt>24 then
   if btnp(0) or btnp(1) or btnp(2) or
      btnp(4) or btnp(5) then
    init_stage()
   end
  end
  return
 end
 
 -- controls
 if btn(0) then
  plx-=1
 elseif btn(1) then
  plx+=1
 end
 if btn(2) then
  ply-=1
 elseif btn(3) then
  ply+=1
 end
 
 -- player animate
 if plfrm==1 then plfrm=3
 else plfrm=1 end
 
 -- collect cows
 foreach(cows,collect_cow)

 if #cows==0 then
  win=true
 end
 
 -- check collision
 if mp_hit(pl_l()/8,pl_u()/8) or
    mp_hit(pl_l()/8,pl_d()/8) or
    mp_hit(pl_r()/8,pl_u()/8) or
    mp_hit(pl_r()/8,pl_d()/8) then
  dead=true
 else
  dead=false
 end
 
end

function draw_cow(cow)
 spr(7,cow.x,cow.y)
end

function _draw()
 
 map(mp*0,0)
 
 -- draw cows
 foreach(cows,draw_cow)

 -- draw player
 spr(plfrm,plx,ply,2,2)

 if win then
  printo("u. f. win!",5*8,8*8)
 elseif dead then
  printo("u try again!",5*8,8*8)
 else
  -- normal gameplay
    
  -- draw birds
  
 end
end

function printo(s,x,y)
 print(s,x-1,y,0)
 print(s,x+1,y,0)
 print(s,x,y-1,0)
 print(s,x,y+1,0)
 print(s,x,y,7)
end

__gfx__
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee3333333330033333eeeeeeeeee0ee0eeeeeeeeeeeee00eee0000000000000000000000000000000000000000
00000000eeeeee0000eeeeeeeeeeee0000eeeeee333333330bb00333ee000eeeee0ee0ee0eeeeee0eee00eee0000000000000000000000000000000000000000
00700700eeeee00c600eeeeeeeeee00c600eeeee333000003bbbb0334044700ee00ee00e00eeee00ee0000ee0000000000000000000000000000000000000000
00077000eeee00c66600eeeeeeee00c66600eeee300bbbbbbbb8803307747740e00ee00ec0e00e0ce00cc00e0000000000000000000000000000000000000000
00077000ee00d066660d00eeee00d066660d00ee30bbbbbbbbb8803307074770ec0000cee000000ee00ee00e0000000000000000000000000000000000000000
00700700e00ddd0000ddd00ee00ddd0000ddd00e0bbbbb88bbbbb03307704470eec00ceeeecccceeec0ee0ce0000000000000000000000000000000000000000
00000000e0adddddddddd80ee08dddddddddda0e03bbbb88bbbbbb0300000004eeecceeeeeeeeeeeee0ee0ee0000000000000000000000000000000000000000
00000000e008a8a8a8a8a00ee00a8a8a8a8a800e088bbbbbbb3bbbb0ee0e0e0eeeeeeeeeeeeeeeeeee0ee0ee0000000000000000000000000000000000000000
00000000ee000dddddd000eeee000dddddd000ee308bb3bbbb33bb30330490333333300333333333000000000000000000000000000000000000000000000000
00000000eee0000000000eeeeee0000000000eee30bb33bbbb88bb03330490330000049033333333000000000000000000000000000000000000000000000000
00000000eeeee000000eeeeeeeeee000000eeeee30bbbbbbbb88bb03330490339999049033333333000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee03388bbbbbbbb303330490334444049033333333000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0338833bbbbb3033330000330000049033333333000000000000000000000000000000000000000000000000
00000000eeeee555555eeeeeeeeee555555eeeee3003300000033033304999033333049033333333000000000000000000000000000000000000000000000000
00000000eeeeee5555eeeeeeeeeeee5555eeeeee3330030540300333304499033333044033333333000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee3333333003333333330000333333000033333333000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee000e00ee0eeeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee005970950090eeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeee0000eeeeeeeee07755799805990eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeee0555900000eee055799995888570eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeee0ee00eeeeeee059995975590ee055988888788570eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeee0500590eeeeee089979557590ee097988858888990eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeee0575090eeeeee0579899998950ee057998988888970eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eee057988570eeeee05998898555550ee077858887789950eeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeee099859750eeeee0999888999750e0999888889889950eeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeee07888850eeeee09795888899950e079958885889590eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eee055977990eeeee057988855987950e07998898899990eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeee00779790eeeee05597999559999007759559959970eeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeee05500eeeeeee0555599959595005999559999970eeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeee00eeeeeeeeee000575807500e055955970959950eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeee0000e00eeee00099770099590eeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
00000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000ee0000eeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000
__gff__
0000000000020200000000000000000000000000000202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1818181818181818181818181818181800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191905061919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191915161919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191905061919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191915161919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1719191919191919191919191919191700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818181700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
